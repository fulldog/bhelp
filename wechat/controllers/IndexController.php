<?php
/**
 * Created by PhpStorm.
 * User: weilone
 * Date: 2018/12/24
 * Time: 23:45
 */

namespace wechat\controllers;

use common\models\bbb\SmsLog;
use yii\helpers\Json;

class IndexController extends MyController
{

    function behaviors()
    {
        return parent::behaviors(); // TODO: Change the autogenerated stub
    }

    function beforeAction($action)
    {
        return parent::beforeAction($action); // TODO: Change the autogenerated stub
    }

    function actions()
    {
        return parent::actions(); // TODO: Change the autogenerated stub
    }

    function actionIndex(){

        return $this->render('index');
    }

    function actionRegister(){

        if (\Yii::$app->request->isPost){

        }

        return $this->render('register');
    }

    function actionSearch(){

    }

    function actionRecharge(){

    }

    function actionSms(){
        if (\Yii::$app->request->isAjax && ($phone = \Yii::$app->request->get('phone'))){
            if (preg_match('/^1(3|4|5|8|7)[0-9]{9}$/',$phone)){
               //todo sms
                $sms = new SmsLog();
                $code = random_int(100000,999999);
                $sms->phone = $phone;
                $sms->code = $code;
                if ($sms->save()){
                    exit(Json::encode([
                        'data'=>[
                            'code'=>$code
                        ],
                        'msg'=>'',
                        'status'=>'succ'
                    ]));
                }
            }
        }
        exit(Json::encode([
            'data'=>[],
            'msg'=>'请输入正确的手机号',
            'status'=>'fail'
        ]));
    }
}